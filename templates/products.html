{% extends 'base.html' %}
{% block content %}
<section class="card">
  <h2>Novo produto</h2>
  <form method="post" class="grid form-grid">
    <input name="name" placeholder="Nome" required />
    <select name="category" id="category-select"><option>Peça</option><option>Computador</option></select>
    <select name="component_class" id="component-class-select">
      <option value="">Classe da peça (opcional)</option>
      <option value="gabinete">Gabinete</option>
      <option value="placa_mae">Placa-mãe</option>
      <option value="processador">Processador</option>
      <option value="memoria_ram">Memória RAM</option>
      <option value="armazenamento">Armazenamento</option>
      <option value="fonte">Fonte</option>
    </select>
    <input name="stock" type="number" min="0" placeholder="Estoque" required />
    <input name="price" type="number" min="0" step="0.01" placeholder="Preço" required />
    <input name="photo_url" type="url" placeholder="URL da foto (opcional)" />
    <button type="submit">Salvar</button>
  </form>
</section>
<section class="card">
  <h2>Estoque atual</h2>
  <table>
    <thead><tr><th>Produto</th><th>Categoria</th><th>Classe</th><th>Estoque</th><th>Preço</th><th>Foto</th></tr></thead>
    <tbody>
      {% for p in products %}
      <tr>
        <td>{{ p.name }}</td><td>{{ p.category }}</td><td>{{ p.component_class or '-' }}</td><td>{{ p.stock }}</td><td>R$ {{ '%.2f'|format(p.price) }}</td>
        <td>{% if p.photo_url %}<a href="{{ p.photo_url }}" target="_blank">Ver</a>{% else %}-{% endif %}</td>
      </tr>
      {% else %}<tr><td colspan="6">Sem produtos.</td></tr>{% endfor %}
    </tbody>
  </table>
</section>
<script>
  const categorySelect = document.getElementById('category-select');
  const classSelect = document.getElementById('component-class-select');
  function togglePieceClass() {
    const isPiece = categorySelect.value === 'Peça';
    classSelect.disabled = !isPiece;
    if (!isPiece) classSelect.value = '';
  }
  categorySelect.addEventListener('change', togglePieceClass);
  togglePieceClass();
</script>
{% endblock %}
